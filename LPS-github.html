<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Pages - Lesson Plan Selector</title>
    <!-- Font Awesome CDN for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- HTML2PDF Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .controls {
            padding: 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }

        .dropdown-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .dropdown-group {
            display: flex;
            flex-direction: column;
        }

        .dropdown-group label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #495057;
            font-size: 1.1rem;
        }

        select {
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        select:hover {
            border-color: #667eea;
        }

        .status {
            text-align: center;
            padding: 15px;
            background: #e3f2fd;
            border-radius: 8px;
            margin-top: 15px;
            font-weight: 500;
            color: #1976d2;
        }

        .lesson-content {
            padding: 30px;
            min-height: 400px;
        }

        .lesson-plan {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }

        .lesson-plan.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .lesson-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 25px;
        }

        .lesson-header h2 {
            font-size: 1.8rem;
            margin-bottom: 8px;
        }

        .lesson-header .meta {
            display: flex;
            gap: 20px;
            font-size: 0.95rem;
            opacity: 0.9;
        }

        .section {
            margin-bottom: 25px;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            border-left: 4px solid #667eea;
        }

        .section h3 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-icon {
            width: 24px;
            height: 24px;
            background: #667eea;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .objectives-list, .materials-list, .tasks-list {
            list-style: none;
        }

        .objectives-list li, .materials-list li, .tasks-list li {
            padding: 10px 0;
            border-bottom: 1px solid #e9ecef;
            position: relative;
            padding-left: 25px;
        }

        .objectives-list li:before {
            content: "üéØ";
            position: absolute;
            left: 0;
        }

        .materials-list li:before {
            content: "üìã";
            position: absolute;
            left: 0;
        }

        .tasks-list li:before {
            content: "‚úÖ";
            position: absolute;
            left: 0;
        }

        .objectives-list li:last-child,
        .materials-list li:last-child,
        .tasks-list li:last-child {
            border-bottom: none;
        }

        .time-estimate {
            background: #e8f5e8;
            color: #2e7d32;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }

        .empty-state .icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: #495057;
        }

        @media (max-width: 768px) {
            .dropdown-container {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 2rem;
            }

            .lesson-header .meta {
                flex-direction: column;
                gap: 10px;
            }

            .controls {
                padding: 20px;
            }

            .lesson-content {
                padding: 20px;
            }
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 20px;
            border: 1px solid #f5c6cb;
        }

        .github-note {
            background: #d1ecf1;
            color: #0c5460;
            padding: 15px;
            border-radius: 8px;
            margin: 20px;
            border: 1px solid #bee5eb;
        }

        /* Teacher Tools Navigation Styles */
        .teacher-tools-nav {
            background: #f8f9fa;
            padding: 25px;
            border-bottom: 2px solid #e9ecef;
            margin: 0;
        }

        .teacher-tools-nav h3 {
            color: #495057;
            margin-bottom: 10px;
            font-size: 1.4rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .teacher-tools-nav p {
            color: #6c757d;
            margin-bottom: 20px;
        }

        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .tool-link {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 15px;
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            text-decoration: none;
            color: #495057;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .tool-link:hover {
            background: #667eea;
            color: white;
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .tool-link i {
            font-size: 1.1rem;
            width: 20px;
            text-align: center;
        }

        @media (max-width: 768px) {
            .tools-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Print Styles */
        @media print {
            body {
                background: white !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            
            .container {
                box-shadow: none !important;
                max-width: none !important;
                margin: 0 !important;
            }
            
            .header, .controls, .teacher-tools-nav, .github-note {
                display: none !important;
            }
            
            .lesson-content {
                padding: 0 !important;
            }
            
            .lesson-plan {
                display: block !important;
            }
            
            .lesson-header {
                background: #667eea !important;
                color: white !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            
            .section {
                break-inside: avoid;
                page-break-inside: avoid;
                margin-bottom: 20px;
            }
            
            .action-buttons {
                display: none !important;
            }
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .action-btn {
            padding: 10px 15px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .print-btn {
            background: #28a745;
            color: white;
        }

        .print-btn:hover {
            background: #218838;
            transform: translateY(-1px);
        }

        .download-btn {
            background: #007bff;
            color: white;
        }

        .download-btn:hover {
            background: #0056b3;
            transform: translateY(-1px);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìö Lesson Plan Selector</h1>
            <p>GitHub Pages Compatible Version - Choose your unit and day</p>
        </div>

        <!-- Teacher Tools & Resources Navigation -->
        <div class="teacher-tools-nav">
            <h3><i class="fas fa-tools"></i> Teacher Tools & Resources</h3>
            <p>Access all curriculum management tools and resources from here:</p>
            <div class="tools-grid">
                <a href="tools/lesson-editor-github.html" class="tool-link" target="_blank">
                    <i class="fas fa-edit"></i>
                    <span>Lesson Editor</span>
                </a>
                <a href="tools/validation-tool.html" class="tool-link" target="_blank">
                    <i class="fas fa-search"></i>
                    <span>Data Validator</span>
                </a>
                <a href="tools/missing-lessons-report.html" class="tool-link" target="_blank">
                    <i class="fas fa-chart-bar"></i>
                    <span>Missing Lessons Report</span>
                </a>
                <a href="tools/lesson-editor.html" class="tool-link" target="_blank">
                    <i class="fas fa-cog"></i>
                    <span>Local Lesson Editor</span>
                </a>
                <a href="LPS.html" class="tool-link" target="_blank">
                    <i class="fas fa-book"></i>
                    <span>Local Lesson Viewer</span>
                </a>
            </div>
        </div>

        <div class="github-note">
            <strong>‚úÖ GitHub Pages Ready!</strong> This version works on GitHub Pages without requiring a server.
        </div>

        <div class="controls">
            <div class="dropdown-container">
                <div class="dropdown-group">
                    <label for="unit-select">üìñ Select Unit:</label>
                    <select id="unit-select">
                        <option value="">-- Choose a Unit --</option>
                    </select>
                </div>

                <div class="dropdown-group">
                    <label for="day-select">üìù Select Day:</label>
                    <select id="day-select" disabled>
                        <option value="">-- Choose a Day --</option>
                    </select>
                </div>
            </div>

            <div class="status" id="status">
                Ready! Select a unit to begin.
            </div>
        </div>

        <div class="lesson-content" id="lesson-content">
            <div class="empty-state">
                <div class="icon">üéì</div>
                <h3>Welcome to the Lesson Plan Selector</h3>
                <p>Select a unit and day from the dropdowns above to view the detailed lesson plan.</p>
            </div>
        </div>
    </div>

    <script src="assets/js/embedded-data.js"></script>
    <script src="assets/js/YearLongLPs.js"></script>
    <!-- Enhanced Security Module -->
    <script src="assets/js/security.js"></script>
    <script>
        class LessonPlanSelector {
            constructor() {
                this.lessonData = COMBINED_CURRICULUM;
                this.unitSelect = document.getElementById('unit-select');
                this.daySelect = document.getElementById('day-select');
                this.lessonContent = document.getElementById('lesson-content');
                this.status = document.getElementById('status');

                this.init();
            }

            async init() {
                this.populateUnits();
                this.setupEventListeners();
                this.showStatus('Ready! Please select a unit to begin.');
            }

            populateUnits() {
                this.unitSelect.innerHTML = '<option value="">-- Choose a Unit --</option>';
                
                if (this.lessonData.curriculum.units) {
                    this.lessonData.curriculum.units.forEach(unit => {
                        const option = document.createElement('option');
                        option.value = unit.unitNumber;
                        option.textContent = `Unit ${unit.unitNumber}: ${unit.unitTitle}`;
                        this.unitSelect.appendChild(option);
                    });
                }
            }

            populateDays(unitNumber) {
                this.daySelect.innerHTML = '<option value="">-- Choose a Day --</option>';
                
                if (!unitNumber) {
                    this.daySelect.disabled = true;
                    return;
                }

                const unit = this.lessonData.curriculum.units.find(u => u.unitNumber == unitNumber);
                
                if (unit && unit.lessons) {
                    this.daySelect.disabled = false;
                    
                    // Filter out incomplete lessons
                    const validLessons = unit.lessons.filter(lesson => 
                        lesson.day && lesson.date && lesson.lesson
                    );
                    
                    if (validLessons.length === 0) {
                        this.daySelect.innerHTML = '<option value="">-- No Complete Lessons Available --</option>';
                        this.daySelect.disabled = true;
                        this.showStatus('This unit has lessons, but they need more data to display properly.');
                        return;
                    }
                    
                    validLessons.forEach(lesson => {
                        const option = document.createElement('option');
                        option.value = lesson.day;
                        option.textContent = `Day ${lesson.day} (${lesson.date}) - ${lesson.lesson}`;
                        this.daySelect.appendChild(option);
                    });
                } else {
                    this.daySelect.innerHTML = '<option value="">-- No Lessons Available --</option>';
                    this.daySelect.disabled = true;
                }
            }

            getUnit(unitNumber) {
                return this.lessonData.curriculum.units.find(unit => unit.unitNumber == unitNumber);
            }

            getLesson(unitNumber, dayNumber) {
                const unit = this.getUnit(unitNumber);
                if (unit && unit.lessons) {
                    return unit.lessons.find(lesson => lesson.day == dayNumber);
                }
                return null;
            }

            setupEventListeners() {
                this.unitSelect.addEventListener('change', (e) => {
                    const unitNumber = e.target.value;
                    this.populateDays(unitNumber);
                    
                    if (unitNumber) {
                        this.showStatus('Now select a day.');
                    } else {
                        this.showStatus('Please select a unit.');
                        this.daySelect.disabled = true;
                        this.showEmptyState();
                    }
                });

                this.daySelect.addEventListener('change', (e) => {
                    const dayNumber = e.target.value;
                    const unitNumber = this.unitSelect.value;
                    
                    if (unitNumber && dayNumber) {
                        this.displayLessonPlan(unitNumber, dayNumber);
                    } else {
                        this.showEmptyState();
                    }
                });
            }

            displayLessonPlan(unitNumber, dayNumber) {
                const lesson = this.getLesson(unitNumber, dayNumber);
                const unit = this.getUnit(unitNumber);
                
                if (!lesson || !unit) {
                    this.showError('Lesson plan not found.');
                    return;
                }

                this.showStatus(`Displaying: Unit ${unit.unitNumber} - Day ${lesson.day} - ${lesson.lesson}`);

                const html = `
                    <div class="lesson-plan active">
                        <div class="action-buttons">
                            <button class="action-btn print-btn" onclick="window.print()">
                                <i class="fas fa-print"></i>
                                Print Lesson Plan
                            </button>
                            <button class="action-btn download-btn" onclick="lessonSelector.downloadPDF()">
                                <i class="fas fa-download"></i>
                                Download PDF
                            </button>
                        </div>
                        
                        <div class="lesson-header">
                            <h2>${lesson.lesson}</h2>
                            <div class="meta">
                                <span class="time-estimate">üìÖ ${lesson.date}</span>
                                <span>üìñ Unit ${unit.unitNumber}</span>
                                <span>üìù Day ${lesson.day}</span>
                                <span>üéØ ${this.lessonData.curriculum.course}</span>
                            </div>
                        </div>

                        <div class="section">
                            <h3>
                                <span class="section-icon">üéØ</span>
                                Learning Objectives
                            </h3>
                            <ul class="objectives-list">
                                ${lesson.objectives.map(obj => `<li>${obj}</li>`).join('')}
                            </ul>
                        </div>

                        <div class="section">
                            <h3>
                                <span class="section-icon">üß†</span>
                                Enduring Understanding
                            </h3>
                            <p style="padding: 10px 0; font-style: italic;">${lesson.enduringUnderstanding}</p>
                        </div>

                        <div class="section">
                            <h3>
                                <span class="section-icon">‚ùì</span>
                                Essential Question
                            </h3>
                            <p style="padding: 10px 0; font-weight: 500; color: #495057;">${lesson.essentialQuestion}</p>
                        </div>

                        <div class="section">
                            <h3>
                                <span class="section-icon">üìã</span>
                                Materials
                            </h3>
                            <div style="display: grid; gap: 15px;">
                                ${lesson.materials.teacher ? `
                                    <div>
                                        <strong>üë©‚Äçüè´ Teacher Materials:</strong>
                                        <p style="margin-top: 5px;">${lesson.materials.teacher}</p>
                                    </div>
                                ` : ''}
                                ${lesson.materials.student ? `
                                    <div>
                                        <strong>üë®‚Äçüéì Student Materials:</strong>
                                        <p style="margin-top: 5px;">${lesson.materials.student}</p>
                                    </div>
                                ` : ''}
                                ${lesson.materials.links ? `
                                    <div>
                                        <strong>üîó Links & Resources:</strong>
                                        <p style="margin-top: 5px;">${lesson.materials.links}</p>
                                    </div>
                                ` : ''}
                            </div>
                        </div>

                        <div class="section">
                            <h3>
                                <span class="section-icon">‚úÖ</span>
                                Lesson Agenda
                            </h3>
                            <div style="background: #fff; padding: 15px; border-radius: 8px; border-left: 4px solid #28a745;">
                                ${this.formatAgenda(lesson.agenda)}
                            </div>
                        </div>

                        <div class="section">
                            <h3>
                                <span class="section-icon">üìä</span>
                                Assessment
                            </h3>
                            <div style="display: grid; gap: 15px;">
                                ${lesson.assessment.formative ? `
                                    <div>
                                        <strong>üìù Formative Assessment:</strong>
                                        <p style="margin-top: 5px;">${lesson.assessment.formative}</p>
                                    </div>
                                ` : ''}
                                ${lesson.assessment.summative ? `
                                    <div>
                                        <strong>üìã Summative Assessment:</strong>
                                        <p style="margin-top: 5px;">${lesson.assessment.summative}</p>
                                    </div>
                                ` : ''}
                            </div>
                        </div>

                        ${lesson.differentiation ? `
                            <div class="section">
                                <h3>
                                    <span class="section-icon">üéØ</span>
                                    Differentiation
                                </h3>
                                <div style="background: #fff; padding: 15px; border-radius: 8px; border-left: 4px solid #17a2b8;">
                                    ${this.formatDifferentiation(lesson.differentiation)}
                                </div>
                            </div>
                        ` : ''}
                    </div>
                `;

                this.lessonContent.innerHTML = html;
            }

            formatAgenda(agenda) {
                if (!agenda) return '';
                
                let cleanAgenda = agenda.toString();
                
                const timePattern = /\((\d+m)\)/g;
                let formattedAgenda = cleanAgenda.replace(timePattern, '<span style="background: #e3f2fd; color: #1976d2; padding: 2px 6px; border-radius: 12px; font-size: 0.9em; font-weight: 500;">‚è±Ô∏è $1</span>');
                
                const parts = formattedAgenda.split(/\.\s*(?=\(|\([0-9]|[A-Z])/);
                
                if (parts.length > 1) {
                    return '<ul style="list-style: none; padding: 0; margin: 0;">' + 
                           parts.filter(part => {
                               const trimmed = part.trim();
                               return trimmed.length > 0 && !trimmed.match(/^(font-weight|font-size|color):/);
                           }).map(part => {
                               let cleanPart = part.trim();
                               if (cleanPart.endsWith('.')) {
                                   cleanPart = cleanPart.slice(0, -1);
                               }
                               if (cleanPart.includes('font-weight') || cleanPart.includes('font-size')) {
                                   return '';
                               }
                               return `<li style="margin-bottom: 8px; padding: 10px; background: #f8f9fa; border-radius: 4px; line-height: 1.4;">‚Ä¢ ${cleanPart}</li>`;
                           }).filter(item => item.length > 0).join('') + 
                           '</ul>';
                } else {
                    return `<p style="line-height: 1.6; margin: 0;">${formattedAgenda}</p>`;
                }
            }

            formatDifferentiation(differentiation) {
                if (!differentiation) return '';
                
                let formatted = differentiation
                    .replace(/Support:/g, '<strong style="color: #28a745;">ü§ù Support:</strong>')
                    .replace(/Challenge:/g, '<strong style="color: #dc3545;">üöÄ Challenge:</strong>');
                
                return `<p>${formatted}</p>`;
            }

            showEmptyState() {
                this.lessonContent.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">üéì</div>
                        <h3>Select a Lesson Plan</h3>
                        <p>Choose a unit and day from the dropdowns above to view the detailed lesson plan.</p>
                    </div>
                `;
            }

            showStatus(message, type = 'info') {
                this.status.textContent = message;
                this.status.className = `status ${type}`;
            }

            showError(message) {
                this.lessonContent.innerHTML = `
                    <div class="error">
                        <strong>Error:</strong> ${message}
                    </div>
                `;
            }

            downloadPDF() {
                const lesson = this.getCurrentDisplayedLesson();
                if (!lesson) {
                    alert('No lesson plan is currently displayed');
                    return;
                }

                const unit = this.getUnit(this.unitSelect.value);
                const filename = `Unit_${unit.unitNumber}_Day_${lesson.day}_${lesson.lesson.replace(/[^a-zA-Z0-9]/g, '_')}.pdf`;
                
                // Get the lesson plan content
                const element = document.querySelector('.lesson-plan.active');
                if (!element) {
                    alert('No lesson plan content found');
                    return;
                }

                // Clone the element to avoid modifying the original
                const clonedElement = element.cloneNode(true);
                
                // Remove action buttons from the cloned element
                const actionButtons = clonedElement.querySelector('.action-buttons');
                if (actionButtons) {
                    actionButtons.remove();
                }

                // Configure PDF options
                const opt = {
                    margin: [10, 10, 10, 10],
                    filename: filename,
                    image: { type: 'jpeg', quality: 0.98 },
                    html2canvas: { 
                        scale: 2,
                        useCORS: true,
                        letterRendering: true
                    },
                    jsPDF: { 
                        unit: 'mm', 
                        format: 'a4', 
                        orientation: 'portrait' 
                    },
                    pagebreak: { mode: ['avoid-all', 'css', 'legacy'] }
                };

                // Generate and download PDF
                html2pdf().set(opt).from(clonedElement).save();
            }

            getCurrentDisplayedLesson() {
                const unitNumber = this.unitSelect.value;
                const dayNumber = this.daySelect.value;
                
                if (unitNumber && dayNumber) {
                    return this.getLesson(unitNumber, dayNumber);
                }
                return null;
            }
        }

        // Initialize the application when the page loads
        let lessonSelector;
        document.addEventListener('DOMContentLoaded', () => {
            lessonSelector = new LessonPlanSelector();
        });
    </script>
</body>
</html>
